<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern File Search Dashboard</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <meta name="description" content="Modern dashboard for Excel-based file searching, PDF parsing, and report export.">
  <meta name="theme-color" content="#4f46e5">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- pdf.js -->
  <script src="https://unpkg.com/pdfjs-dist@3.10.111/build/pdf.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.264.0/dist/lucide.min.js"></script>

  <style>
    body { font-family: ui-sans-serif, system-ui, sans-serif; }
    .tab { cursor: pointer; padding: 0.5rem 1rem; border-bottom: 2px solid transparent; }
    .tab.active { border-color: #6366f1; font-weight: 600; }
    .tabpanel { display: none; }
    .tabpanel.active { display: block; }
    #dropArea { transition: ring 0.2s; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-200 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-indigo-600 text-white p-4 shadow flex justify-between items-center">
    <h1 class="text-lg font-bold">File Search Dashboard</h1>
    <div class="flex gap-3">
      <button id="downloadReportBtn" class="bg-indigo-500 hover:bg-indigo-700 px-3 py-1 rounded text-sm" disabled>Download Report</button>
      <button id="clearLog" class="bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 px-3 py-1 rounded text-sm">Clear Log</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="flex bg-white dark:bg-slate-800 shadow p-2 space-x-2">
    <div class="tab active" data-tab="templateTab">Template</div>
    <div class="tab" data-tab="sourceTab">Source/Dest</div>
    <div class="tab" data-tab="searchTab">Search</div>
    <div class="tab" data-tab="logTab">Logs</div>
    <div class="tab" data-tab="reportTab">Report</div>
  </nav>

  <!-- Main -->
  <main class="flex-1 p-4 overflow-auto">
    
    <!-- Template Tab -->
    <section id="templateTab" class="tabpanel active">
      <h2 class="font-bold mb-2">Upload Template</h2>
      <div id="dropArea" class="border-2 border-dashed rounded p-6 text-center text-slate-500">
        Drag & drop template here or <span id="templateClick" class="text-indigo-600 underline cursor-pointer">click to select</span>
        <input type="file" id="templateFile" class="hidden" accept=".xlsx">
      </div>
      <p id="templateInfo" class="mt-2 text-sm text-slate-600 dark:text-slate-300">No template loaded</p>
      <div id="previewWrap" class="hidden mt-3">
        <ul id="previewList" class="flex flex-wrap gap-2"></ul>
      </div>
      <div class="mt-3 flex gap-2">
        <button id="clearTemplate" class="hidden px-3 py-1 rounded bg-red-500 hover:bg-red-700 text-white text-sm">Clear</button>
        <button id="downloadSample" class="px-3 py-1 rounded bg-indigo-500 hover:bg-indigo-700 text-white text-sm">Download Sample</button>
        <button id="exportTemplate" class="px-3 py-1 rounded bg-green-500 hover:bg-green-700 text-white text-sm" disabled>Export Template</button>
      </div>
      <div id="templateTableWrap" class="mt-4 overflow-auto"></div>
    </section>

    <!-- Source/Dest Tab -->
    <section id="sourceTab" class="tabpanel">
      <h2 class="font-bold mb-2">Select Folders</h2>
      <div class="flex flex-col gap-4">
        <button id="chooseSource" class="px-3 py-2 rounded bg-indigo-500 hover:bg-indigo-700 text-white text-sm w-60">Choose Source Folder</button>
        <p id="sourceInfo" class="text-sm text-slate-600 dark:text-slate-300">No source selected</p>
        <button id="chooseDest" class="px-3 py-2 rounded bg-indigo-500 hover:bg-indigo-700 text-white text-sm w-60">Choose Destination Folder</button>
        <p id="destInfo" class="text-sm text-slate-600 dark:text-slate-300">No destination selected</p>
      </div>
    </section>

    <!-- Search Tab -->
    <section id="searchTab" class="tabpanel">
      <h2 class="font-bold mb-2">Search Controls</h2>
      <div class="flex gap-2 items-center">
        <button id="startBtn" class="px-4 py-2 rounded bg-green-500 hover:bg-green-700 text-white">Start Search</button>
        <button id="cancelBtn" class="px-4 py-2 rounded bg-red-500 hover:bg-red-700 text-white">Cancel</button>
        <label class="flex items-center gap-1">
          <input type="checkbox" id="copyFilesToggle">
          Copy matched files
        </label>
        <label class="flex items-center gap-1">
          <input type="checkbox" id="caseInsensitive" checked>
          Case insensitive
        </label>
      </div>
      <div class="mt-3">
        <div id="status" class="font-medium">Idle</div>
        <div class="w-full h-2 bg-slate-200 rounded mt-1">
          <div id="progressBar" class="h-2 bg-indigo-500 rounded w-0"></div>
        </div>
        <div id="progressText" class="text-xs mt-1 text-slate-600 dark:text-slate-300">0 / 0</div>
      </div>
    </section>

    <!-- Logs Tab -->
    <section id="logTab" class="tabpanel">
      <h2 class="font-bold mb-2">Logs</h2>
      <textarea id="log" readonly class="w-full h-80 p-2 text-xs font-mono bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 rounded"></textarea>
      <div id="logCount" class="text-sm mt-1 text-slate-600 dark:text-slate-300">0 log entries</div>
    </section>

    <!-- Report Tab -->
    <section id="reportTab" class="tabpanel">
      <h2 class="font-bold mb-2">Report Preview</h2>
      <div id="reportPreview" class="space-y-2"></div>
    </section>

  </main>

  <!-- Include app.js -->
  <script src="app.js"></script>
  <script>
    // Tabs logic
    const tabButtons = document.querySelectorAll('.tab');
    const tabPanels = document.querySelectorAll('.tabpanel');

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        tabPanels.forEach(p => p.classList.remove('active'));
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // Drag & drop fallback click
    const templateClick = document.getElementById('templateClick');
    const templateInput = document.getElementById('templateFile');
    const dropArea = document.getElementById('dropArea');

    templateClick.addEventListener('click', () => templateInput.click());
    dropArea.addEventListener('dragover', e => {
      e.preventDefault();
      dropArea.classList.add('ring-2', 'ring-indigo-400');
    });
    dropArea.addEventListener('dragleave', () => dropArea.classList.remove('ring-2', 'ring-indigo-400'));
    dropArea.addEventListener('drop', e => {
      e.preventDefault();
      dropArea.classList.remove('ring-2', 'ring-indigo-400');
      if (e.dataTransfer.files.length > 0) {
        templateInput.files = e.dataTransfer.files;
        loadXlsxFile(e.dataTransfer.files[0]);
      }
    });
    templateInput.addEventListener('change', e => {
      if (e.target.files.length > 0) loadXlsxFile(e.target.files[0]);
    });
  </script>

</body>
</html>
